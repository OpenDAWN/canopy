<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>

  <canvas id="i-canvas"></canvas>

  <script src="canopy.timeruler.js"></script>
  <script src="canopy.ampruler.js"></script>
  <script src="canopy.waveformdrawer.js"></script>
  <script>
    var cvs = document.getElementById('i-canvas');
    var ctx = cvs.getContext('2d');
    var cvsOff = document.createElement('canvas');
    var ctxOff = cvsOff.getContext('2d');

    ctx.canvas.width = ctxOff.canvas.width = 800;
    ctx.canvas.height = ctxOff.canvas.height = 500;

    var timeruler = Canopy.createTimeRuler(ctxOff, 49, 10, 800);
    var ampruler1 = Canopy.createAmpRuler(ctxOff, 10, 43, 38, 200);
    var ampruler2 = Canopy.createAmpRuler(ctxOff, 10, 244, 38, 200);
    var waveformDrawer1 = Canopy.createWaveformDrawer(ctxOff, 49, 43, 800, 200);
    var waveformDrawer2 = Canopy.createWaveformDrawer(ctxOff, 49, 244, 800, 200);

    var start = 2.5, end = 11.0;
    var phi1 = 0, phi2 = 0, phi3 = 0;

    var sin = new Float32Array(882000);
    var z = 0.003;
    for (var i = 0; i < 882000; i++) {
      sin[i] = Math.sin(z);
      z += 0.001;
    }

    waveformDrawer1.setSampleData(sin, 44100);
    waveformDrawer2.setSampleData(sin, 44100);

    function runTest() {

      ctxOff.clearRect(0, 0, 800, 500);

      var absPeak = 0.5 + (Math.sin(phi1) * 0.5 + 0.5) * 5;
      var tau1 = start + Math.sin(phi2) * 2;
      var tau2 = end + Math.cos(phi3) * 6.5;

      waveformDrawer1.draw(tau1, tau2, absPeak);
      waveformDrawer2.draw(tau1, tau2, absPeak);
      ampruler1.draw(absPeak);
      ampruler2.draw(absPeak);
      timeruler.draw(tau1, tau2);

      phi1 += 0.013;
      phi2 += 0.011;
      phi3 += 0.007;

      ctx.drawImage(cvsOff, 0, 0, 800, 500);

      requestAnimationFrame(runTest);
    }

    function runRenderer() {

      ctxOff.clearRect(0, 0, 800, 500);

      var tau1 = 1.0, tau2 = 1.003;
      var absPeak = 4.0;

      waveformDrawer1.draw(tau1, tau2, absPeak);
      waveformDrawer2.draw(tau1, tau2, absPeak);
      ampruler1.draw(absPeak);
      ampruler2.draw(absPeak);
      timeruler.draw(tau1, tau2);

      ctx.drawImage(cvsOff, 0, 0, 800, 500);
    };

    runTest();
    // runRenderer();
  </script>

</body>
</html>